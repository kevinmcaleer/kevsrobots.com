{% assign bg_colour = include.bg_color %}
{% if bg_colour %}
  {% assign text_color = "text-white" %}
  {% assign icon_color = "white" %}
{% else %}
  {% assign text_color = "text-dark" %}
  {% assign icon_color = "black" %}
{% endif %}

<div class="like-comment-section mt-4" data-url="{{ page.url }}">

  <!-- Stats Section -->
  <div class="engagement-stats mb-3 d-flex align-items-center gap-3">
    <!-- Page Views -->
    <div class="view-stats">
      <i class="fa-solid fa-chart-simple {{ text_color }}"></i>
      <span class="view-count {{ text_color }} ms-1" id="view-count">0</span>
      <span class="{{ text_color }} small ms-1">views</span>
    </div>

    <!-- Like Button -->
    <div class="like-stats">
      <button class="btn btn-link p-0 like-button text-decoration-none {{ text_color }}" id="like-btn" aria-label="Like this content">
        <i class="fa-regular fa-heart heart-outline" style="font-size: 1.5rem; color: #dc3545;"></i>
        <i class="fa-solid fa-heart heart-filled" style="font-size: 1.5rem; color: #dc3545; display: none;"></i>
      </button>
      <span class="like-count {{ text_color }} ms-1" id="like-count">0</span>
    </div>
  </div>

  <!-- Mini Page View Graph -->
  <div class="page-view-graph mb-3" data-url="{{ page.url }}"></div>

  <!-- Comment Input Section -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h5 class="{{ text_color }} mb-0">Comments</h5>
    <div class="btn-group btn-group-sm" role="group" aria-label="Sort comments">
      <button type="button" class="btn btn-outline-secondary active" id="sort-recent-btn" onclick="sortComments('recent')">
        <i class="fa-solid fa-clock me-1"></i>Recent
      </button>
      <button type="button" class="btn btn-outline-secondary" id="sort-popular-btn" onclick="sortComments('popular')">
        <i class="fa-solid fa-fire me-1"></i>Popular
      </button>
    </div>
  </div>
  <div class="comment-input-section mb-4">
    <div class="position-relative">
      <textarea class="form-control comment-input" id="comment-textarea" rows="3" placeholder="Post your comment..." style="resize: vertical; min-height: 80px;"></textarea>
      <div class="d-flex justify-content-end mt-2">
        <button class="btn btn-primary btn-sm" id="post-comment-btn" disabled>
          <i class="fa-solid fa-paper-plane me-1"></i> Post Comment
        </button>
      </div>
    </div>
    <div id="comment-error" class="alert alert-danger mt-2" style="display: none;"></div>
    <div id="comment-success" class="alert alert-success mt-2" style="display: none;"></div>
  </div>

  <!-- Comments List Section -->
  <div class="comments-list" id="comments-list">
    <div class="text-center {{ text_color }} py-3" id="comments-loading">
      <div class="spinner-border spinner-border-sm me-2" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      Loading comments...
    </div>
    <div id="comments-container"></div>
    <div class="text-center {{ text_color }} py-3" id="no-comments" style="display: none;">
      <i class="fa-regular fa-comment me-2"></i>No comments yet. Be the first to comment!
    </div>
  </div>
</div>

<link rel="stylesheet" href="/assets/css/like-comment.css?v=20251103-3">
<link rel="stylesheet" href="/assets/css/page-view-graph.css">
<script src="/assets/js/like-comment.js?v=20251103-3"></script>
<script src="/assets/js/page-view-graph.js?v=20251103-3"></script>
