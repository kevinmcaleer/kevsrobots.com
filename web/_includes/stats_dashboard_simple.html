<!-- Simplified Stats Dashboard - Uses iframe to avoid CORS -->
<div class="stats-container">
    <div style="padding: 20px; background: #f5f5f5; border-radius: 8px; margin-bottom: 20px;">
        <h2>Analytics Dashboard</h2>
        <p>Loading analytics data...</p>
        <p><small>If you see this message for more than a few seconds, the dashboard service may be unavailable.</small></p>
    </div>

    <script>
    // Simpler approach: Fetch and display as JSON for now to verify connectivity
    async function testConnection() {
        try {
            console.log('Testing connection to stats API...');
            const response = await fetch('https://stats.kevsrobots.com/api/dashboard', {
                mode: 'cors',
                credentials: 'omit'
            });
            console.log('Response status:', response.status);
            if (response.ok) {
                const data = await response.json();
                console.log('Data received successfully:', data);
                document.querySelector('.stats-container').innerHTML = `
                    <div style="padding: 20px; background: #d4edda; border: 1px solid #c3e6cb; border-radius: 8px;">
                        <h2>✓ Connection Successful</h2>
                        <p><strong>Total Visits (Last Month):</strong> ${data.totals.visits_last_month.toLocaleString()}</p>
                        <p><strong>Total Searches (Last Month):</strong> ${data.totals.searches_last_month.toLocaleString()}</p>
                        <p><strong>Total Users:</strong> ${data.user_stats.total_users.toLocaleString()}</p>
                        <p><strong>Returning Users:</strong> ${data.user_stats.returning_users.toLocaleString()}</p>
                        <p><small>Last updated: ${new Date(data.last_updated).toLocaleString()}</small></p>
                    </div>
                `;
            } else {
                throw new Error(`HTTP ${response.status}`);
            }
        } catch (error) {
            console.error('Connection failed:', error);
            document.querySelector('.stats-container').innerHTML = `
                <div style="padding: 20px; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 8px;">
                    <h2>✗ Connection Failed</h2>
                    <p><strong>Error:</strong> ${error.message}</p>
                    <p>The analytics API may need to be redeployed with updated CORS settings.</p>
                    <p><strong>Next steps:</strong></p>
                    <ol>
                        <li>Run: <code>cd /Users/kev/Python/ducklake</code></li>
                        <li>Run: <code>./deploy_to_production.sh</code></li>
                        <li>Enter password when prompted</li>
                        <li>Wait for deployment to complete</li>
                        <li>Refresh this page</li>
                    </ol>
                </div>
            `;
        }
    }

    // Run test when page loads
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', testConnection);
    } else {
        testConnection();
    }
    </script>
</div>
